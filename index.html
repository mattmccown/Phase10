<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Phase 10 Multi-Tracker</title>
<link rel="apple-touch-icon" href="icon.png">
<style>
  body { font-family: -apple-system, sans-serif; margin: 15px; background-color: #f0f2f5; color: #1c1e21; padding-bottom: 50px; }
  h1 { text-align: center; color: #007AFF; margin-bottom: 5px; }
  
  .player-box { background: white; padding: 15px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
  .name-row { display: flex; justify-content: space-between; align-items: center; }
  .phase-display { background: #E7F3FF; color: #1877F2; padding: 4px 10px; border-radius: 15px; font-weight: bold; font-size: 0.85rem; }
  .score-total { font-size: 2rem; font-weight: 800; text-align: center; margin: 5px 0; }
  .input-group { display: flex; gap: 8px; margin-top: 10px; }
  input[type=text] { flex-grow: 1; padding: 10px; font-size: 1.1rem; border: 2px solid #ddd; border-radius: 10px; text-align: center; }
  
  button { padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
  .btn-phase-up { background-color: #007AFF; color: white; flex-grow: 2; }
  .btn-phase-down { background-color: #8E8E93; color: white; padding: 12px 15px; }
  .btn-add-round { background-color: #34C759; color: white; width: 100%; margin-top: 10px; font-size: 1.1rem; }
  .btn-undo { background-color: #FF9500; color: white; width: 100%; margin-top: 8px; font-size: 0.8rem; }
  
  details { background: white; border-radius: 12px; margin-top: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
  summary { padding: 12px; font-weight: bold; font-size: 0.9rem; color: #555; cursor: pointer; list-style: none; display: flex; justify-content: space-between; align-items: center; }
  summary::after { content: '‚ñº'; font-size: 0.7rem; color: #888; }
  details[open] summary::after { content: '‚ñ≤'; }
  .collapsible-content { padding: 0 12px 12px 12px; border-top: 1px solid #f0f2f5; }
  
  .player-pill { display: inline-flex; align-items: center; background: #eee; padding: 5px 10px; border-radius: 20px; margin: 5px; font-size: 0.8rem; }
  .remove-p { color: red; margin-left: 8px; font-weight: bold; }
  
  table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
  th, td { padding: 8px; text-align: center; border-bottom: 1px solid #f9f9f9; }
  .winner-section { text-align: center; background: #34C759; color: white; padding: 15px; border-radius: 15px; display: none; margin: 20px 0; }
  .btn-reset { background-color: #FF3B30; color: white; width: 100%; margin-top: 40px; font-size: 0.8rem; }
</style>
</head>
<body>

<h1>Phase 10 Tracker</h1>

<details>
  <summary>Manage Players & Lifetime</summary>
  <div class="collapsible-content">
    <div id="playerPills"></div>
    <div class="input-group">
      <input type="text" id="newPlayerName" placeholder="New Player Name">
      <button class="btn-phase-up" onclick="addPlayer()">Add</button>
    </div>
  </div>
</details>

<div id="gameBoard"></div>

<button class="btn-add-round" onclick="submitRound()">End Round / Add Points</button>
<button class="btn-undo" onclick="undoLastRound()">Undo Last Entry</button>

<div id="winnerBox" class="winner-section">
  <h2 id="winnerText" style="margin:0"></h2>
  <button onclick="recordWin()" style="margin-top:10px; background: white; color: #34C759; border:none; padding:12px; border-radius:8px; font-weight:bold; width: 100%;">Save Game & Reset</button>
</div>

<details>
  <summary>Phase Requirements</summary>
  <div class="collapsible-content" style="font-size: 0.8rem;">
    1: 2 sets of 3 | 2: 1 set of 3+1 run of 4 | 3: 1 set of 4+1 run of 4 | 4: 1 run of 7 | 5: 1 run of 8 | 6: 1 run of 9 | 7: 2 sets of 4 | 8: 7 of 1 color | 9: 1 set of 5+1 set of 2 | 10: 1 set of 5+1 set of 3
  </div>
</details>

<details open>
  <summary>Current Game History</summary>
  <div class="collapsible-content" id="roundHistory"></div>
</details>

<details>
  <summary>Master Game Log</summary>
  <div class="collapsible-content">
    <table id="masterTable">
      <thead><tr><th>Date</th><th>Players/Scores</th><th>Win</th></tr></thead>
      <tbody id="masterBody"></tbody>
    </table>
  </div>
</details>

<button class="btn-reset" onclick="fullReset()">Wipe Everything</button>

<script>
let state = JSON.parse(localStorage.getItem('p10Multi')) || {
  players: [
    { name: 'Matt', score: 0, phase: 1, wins: 0 },
    { name: 'Emily', score: 0, phase: 1, wins: 0 }
  ],
  rounds: [],
  history: []
};

function update() {
  const board = document.getElementById('gameBoard');
  const pills = document.getElementById('playerPills');
  board.innerHTML = '';
  pills.innerHTML = '';

  state.players.forEach((p, idx) => {
    // Build Game Board
    board.innerHTML += `
      <div class="player-box">
        <div class="name-row">
          <strong>${p.name} <small>(üèÜ${p.wins})</small></strong>
          <div class="phase-display">Phase <span>${p.phase}</span></div>
        </div>
        <div class="score-total">${p.score}</div>
        <div class="input-group">
          <input type="text" inputmode="numeric" id="input-${idx}" placeholder="Pts">
          <button class="btn-phase-up" onclick="changePhase(${idx}, 1)">‚Üë</button>
          <button class="btn-phase-down" onclick="changePhase(${idx}, -1)">‚Üì</button>
        </div>
      </div>`;
    
    // Build Management Pills
    pills.innerHTML += `
      <span class="player-pill">
        ${p.name} (Wins: ${p.wins}) 
        <span class="remove-p" onclick="removePlayer(${idx})">‚úï</span>
      </span>`;
  });

  // Current History Table
  let hHTML = '<table><thead><tr><th>Rd</th>' + state.players.map(p => `<th>${p.name.charAt(0)}</th>`).join('') + '</tr></thead><tbody>';
  state.rounds.slice().reverse().forEach((r, i) => {
    hHTML += `<tr><td>${state.rounds.length - i}</td>` + r.map(pts => `<td>+${pts}</td>`).join('') + '</tr>';
  });
  document.getElementById('roundHistory').innerHTML = hHTML + '</tbody></table>';

  // Master Log
  document.getElementById('masterBody').innerHTML = state.history.slice().reverse().map(h => `
    <tr><td>${h.date}</td><td>${h.summary}</td><td>${h.winner}</td></tr>
  `).join('');

  // Win Logic
  const winBox = document.getElementById('winnerBox');
  const finishers = state.players.filter(p => p.phase > 10);
  if (finishers.length > 0) {
    winBox.style.display = 'block';
    let winner = finishers.sort((a,b) => a.score - b.score)[0];
    document.getElementById('winnerText').textContent = winner.name + " Wins!";
    window.lastWinnerIdx = state.players.indexOf(winner);
  } else { winBox.style.display = 'none'; }

  localStorage.setItem('p10Multi', JSON.stringify(state));
}

function addPlayer() {
  const name = document.getElementById('newPlayerName').value;
  if (name) {
    state.players.push({ name, score: 0, phase: 1, wins: 0 });
    document.getElementById('newPlayerName').value = '';
    update();
  }
}

function removePlayer(idx) {
  if (confirm("Remove " + state.players[idx].name + "?")) {
    state.players.splice(idx, 1);
    update();
  }
}

function changePhase(idx, amt) {
  state.players[idx].phase = Math.max(1, state.players[idx].phase + amt);
  update();
}

function submitRound() {
  let roundPts = [];
  state.players.forEach((p, i) => {
    let pts = parseInt(document.getElementById(`input-${i}`).value) || 0;
    p.score += pts;
    roundPts.push(pts);
    document.getElementById(`input-${i}`).value = '';
  });
  state.rounds.push(roundPts);
  update();
}

function undoLastRound() {
  if (state.rounds.length > 0) {
    let last = state.rounds.pop();
    state.players.forEach((p, i) => p.score -= last[i]);
    update();
  }
}

function recordWin() {
  let summary = state.players.map(p => `${p.name.charAt(0)}:${p.score}`).join(' ');
  state.history.push({
    date: new Date().toLocaleDateString('en-US', {month:'numeric', day:'numeric'}),
    summary: summary,
    winner: state.players[window.lastWinnerIdx].name.charAt(0)
  });
  state.players[window.lastWinnerIdx].wins++;
  state.players.forEach(p => { p.score = 0; p.phase = 1; });
  state.rounds = [];
  update();
}

function fullReset() { if(confirm("Wipe all players, wins, and history?")) { localStorage.clear(); location.reload(); } }

update();
</script>
</body>
</html>
